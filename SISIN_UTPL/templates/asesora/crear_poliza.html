{% extends "asesora/base.html" %}
{% load static %}

{% block title %}Crear P√≥liza{% endblock %}
{% block header %}Crear Nueva P√≥liza{% endblock %}

{% block content %}
<form method="post" class="space-y-6" id="poliza-form">
  {% csrf_token %}

  <!-- Encabezado -->
  <div class="flex items-center gap-4">
    <a href="{% url 'crear_poliza' %}" class="p-2 hover:bg-accent rounded-lg">‚Üê</a>
    <div>
      <h2 class="text-xl font-semibold">Crear Nueva P√≥liza</h2>
      <p class="text-muted-foreground text-sm">
        Ingrese la informaci√≥n general de la p√≥liza
      </p>
    </div>
  </div>

  <!-- üü¶ SECCI√ìN 1: DATOS DE LA P√ìLIZA -->
  <div class="bg-card rounded-lg border p-6">
    <h3 class="mb-4 pb-3 border-b font-medium">üìÑ Datos de la P√≥liza</h3>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div>
        <label class="block text-sm mb-2">Nro. P√≥liza</label>
        <input name="numero_poliza" class="input" placeholder="POL-000123" required />
      </div>

      <div>
        <label class="block text-sm mb-2">Aseguradora</label>
        <input name="aseguradora" class="input" placeholder="Nombre de la aseguradora" required />
      </div>

      <div>
        <label class="block text-sm mb-2">Fecha de Emisi√≥n</label>
        <input type="date" name="fecha_emision" class="input" required />
      </div>

      <div>
        <label class="block text-sm mb-2">Fecha Inicio</label>
        <input type="date" name="fecha_inicio" class="input" required />
      </div>

      <div>
        <label class="block text-sm mb-2">Fecha Fin</label>
        <input type="date" name="fecha_fin" class="input" required />
      </div>

      <div>
        <label class="block text-sm mb-2">Total Prima</label>
        <input type="number" step="0.01" name="total_prima" class="input" placeholder="0.00" required />
      </div>
    </div>
  </div>

  <!-- üü¶ SECCI√ìN 2: BIEN ASEGURADO -->
  <div class="bg-card rounded-lg border p-6">
    <h3 class="mb-4 pb-3 border-b font-medium">üè† Bien Asegurado</h3>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div class="col-span-1 md:col-span-2">
        <label class="block text-sm mb-2">Descripci√≥n del Bien</label>
        <textarea name="descripcion_bien" rows="3" class="input" placeholder="Descripci√≥n detallada del bien asegurado..." required></textarea>
      </div>

      <div>
        <label class="block text-sm mb-2">Tipo de Bien</label>
        <select name="tipo_bien" class="input" required>
          <option value="">Seleccione</option>
          <option value="Residencial">Residencial</option>
          <option value="Comercial">Comercial</option>
          <option value="Industrial">Industrial</option>
        </select>
      </div>

      <div>
        <label class="block text-sm mb-2">Zona / Ubicaci√≥n</label>
        <input name="zona" class="input" placeholder="Ciudad / Sector" required />
      </div>

      <div>
        <label class="block text-sm mb-2">Valor del Bien</label>
        <input type="number" step="0.01" name="valor_bien" class="input" placeholder="0.00" required />
      </div>
    </div>
  </div>

  <!-- üü¶ SECCI√ìN 3: RAMOS -->
  <div class="bg-card rounded-lg border p-6">
    <div class="flex items-center justify-between mb-6">
      <div class="flex items-center gap-2">
        <span class="text-xl">üìä</span>
        <h3 class="font-semibold text-lg">Ramos de la P√≥liza</h3>
      </div>
      <button type="button" id="add-ramo-btn" class="btn-add">
        <span>+</span> Agregar Ramo
      </button>
    </div>

    {{ formset.management_form }}

    <div class="overflow-x-auto">
      <table class="w-full border-separate border-spacing-y-2">
        <thead>
          <tr class="bg-muted/30">
            <th class="p-3 text-sm text-left">Grupo</th>
            <th class="p-3 text-sm text-left">Subgrupo</th>
            <th class="p-3 text-sm text-left">Ramo</th>
            <th class="p-3 text-sm text-left">Suma Asegurada</th>
            <th class="p-3 text-sm text-left">Deducible %</th>
            <th class="p-3 text-sm text-center">Acci√≥n</th>
          </tr>
        </thead>
        <tbody id="ramos-container">
          {% for form in formset %}
          <tr class="ramo-form bg-white">
            <td class="p-1"><input name="ramos-{{ forloop.counter0 }}-grupo" class="input text-sm" required></td>
            <td class="p-1"><input name="ramos-{{ forloop.counter0 }}-subgrupo" class="input text-sm"></td>
            <td class="p-1"><input name="ramos-{{ forloop.counter0 }}-ramo" class="input text-sm" required></td>
            <td class="p-1"><input type="number" step="0.01" name="ramos-{{ forloop.counter0 }}-suma_asegurada" class="input text-sm" required></td>
            <td class="p-1"><input type="number" step="0.01" name="ramos-{{ forloop.counter0 }}-deducible" class="input text-sm"></td>
            <td class="p-2 text-center">
              <button type="button" class="delete-ramo-btn text-destructive">üóëÔ∏è</button>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- BOTONES -->
  <div class="flex justify-end gap-4">
    <a href="{% url 'crear_poliza' %}" class="px-6 py-3 border rounded-lg hover:bg-accent">Cancelar</a>
    <button type="submit" class="px-6 py-3 bg-primary text-primary-foreground rounded-lg">
      Guardar P√≥liza
    </button>
  </div>
</form>
{% endblock %}
