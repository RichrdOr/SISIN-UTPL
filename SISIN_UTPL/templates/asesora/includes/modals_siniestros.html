<div id="modal-docs-incompletos" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-lg shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
        <div class="sticky top-0 bg-[#F2A900] text-white p-6 rounded-t-lg flex items-center justify-between z-10">
            <h2 class="text-xl font-semibold">‚ö†Ô∏è Documentaci√≥n Incompleta</h2>
            <button type="button" onclick="cerrarModal('modal-docs-incompletos')" class="p-1 hover:bg-white hover:bg-opacity-20 rounded-lg">‚úï</button>
        </div>

        <form method="POST" action="{% url 'marcar_docs_incompletos' siniestro.id %}">
            {% csrf_token %}
            <div class="p-6 space-y-6">
                <div class="bg-orange-50 border border-orange-200 rounded-lg p-4">
                    <p class="text-sm text-gray-800">
                        El siniestro pasar√° a estado <strong>Docs Incompletos</strong>. Se notificar√° al usuario para que subsane las observaciones.
                    </p>
                </div>

                <div>
                    <label class="block text-sm text-gray-600 mb-3 font-semibold">Seleccione qu√© falta:</label>
                    <div class="space-y-2">
                        <label class="flex items-center gap-3 p-2 bg-gray-50 rounded cursor-pointer">
                            <input type="checkbox" name="docs_faltantes" value="Identificaci√≥n" class="text-orange-500 rounded">
                            <span class="text-sm">C√©dula / Identificaci√≥n ilegible</span>
                        </label>
                        <label class="flex items-center gap-3 p-2 bg-gray-50 rounded cursor-pointer">
                            <input type="checkbox" name="docs_faltantes" value="Poliza" class="text-orange-500 rounded">
                            <span class="text-sm">P√≥liza o anexo faltante</span>
                        </label>
                        <label class="flex items-center gap-3 p-2 bg-gray-50 rounded cursor-pointer">
                            <input type="checkbox" name="docs_faltantes" value="Evidencia" class="text-orange-500 rounded">
                            <span class="text-sm">Fotos o evidencia insuficiente</span>
                        </label>
                    </div>
                </div>

                <div>
                    <label class="block text-sm text-gray-600 mb-2">Mensaje al Usuario *</label>
                    <textarea name="observaciones" rows="3" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-orange-400" required placeholder="Explique qu√© debe corregir..."></textarea>
                </div>
            </div>

            <div class="bg-gray-50 px-6 py-4 rounded-b-lg flex justify-end gap-3 border-t">
                <button type="button" onclick="cerrarModal('modal-docs-incompletos')" class="px-4 py-2 border rounded-lg">Cancelar</button>
                <button type="submit" class="px-6 py-2 bg-[#F2A900] text-white rounded-lg hover:bg-orange-600">Notificar al Usuario</button>
            </div>
        </form>
    </div>
</div>

<div id="modal-docs-completos" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-lg shadow-2xl max-w-2xl w-full">
        <div class="bg-[#1F6FB2] text-white p-6 rounded-t-lg flex items-center justify-between">
            <h2 class="text-xl font-semibold">üìã Validar Documentaci√≥n</h2>
            <button type="button" onclick="cerrarModal('modal-docs-completos')" class="p-1 hover:bg-white hover:bg-opacity-20 rounded-lg">‚úï</button>
        </div>

        <form method="POST" action="{% url 'confirmar_documentos' siniestro.id %}">
            {% csrf_token %}
            <div class="p-6 space-y-6">
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <p class="text-sm text-gray-800">
                        Confirme que ha revisado los documentos cargados y que cumplen con los requisitos m√≠nimos para ser procesados.
                    </p>
                </div>

                <div>
                    <h4 class="text-sm font-semibold text-gray-700 mb-2">Documentos en sistema:</h4>
                    <ul class="space-y-2">
                        {% for doc in documentos %}
                        <li class="flex items-center text-sm text-gray-600">
                            <span class="text-green-500 mr-2">‚úî</span> {{ doc.tipo }}
                        </li>
                        {% empty %}
                        <li class="text-sm text-red-500 italic">No hay documentos cargados a√∫n.</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>

            <div class="bg-gray-50 px-6 py-4 rounded-b-lg flex justify-end gap-3 border-t">
                <button type="button" onclick="cerrarModal('modal-docs-completos')" class="px-4 py-2 border rounded-lg">Cancelar</button>
                <button type="submit" class="px-6 py-2 bg-[#1F6FB2] text-white rounded-lg hover:bg-blue-700">Validar y Continuar</button>
            </div>
        </form>
    </div>
</div>

<div id="modal-envio" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-lg shadow-2xl max-w-2xl w-full">
        <div class="bg-[#1F6FB2] text-white p-6 rounded-t-lg flex items-center justify-between">
            <h2 class="text-xl font-semibold">üì§ Enviar a Aseguradora</h2>
            <button type="button" onclick="cerrarModal('modal-envio')" class="p-1 hover:bg-white hover:bg-opacity-20 rounded-lg">‚úï</button>
        </div>

        <form method="POST" action="{% url 'enviar_aseguradora' siniestro.id %}">
            {% csrf_token %}
            <div class="p-6 space-y-6">
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 flex gap-3">
                    <span class="text-2xl">üìß</span>
                    <div>
                        <p class="text-sm text-gray-800">
                            Se enviar√° un correo a la aseguradora con la informaci√≥n y documentos disponibles actualmente.
                        </p>
                    </div>
                </div>

                <div>
                    <label class="block text-sm text-gray-600 mb-1">Destinatario</label>
                    <input type="text" value="siniestros@aseguradora.com" class="w-full border rounded-lg p-2 bg-gray-50" readonly>
                </div>

                <div>
                    <label class="block text-sm text-gray-600 mb-1">Nota Adicional al Correo</label>
                    <textarea name="mensaje_correo" rows="3" class="w-full border rounded-lg p-2"></textarea>
                </div>

                <div class="flex items-start gap-2">
                    <input type="checkbox" required id="check_envio" class="mt-1">
                    <label for="check_envio" class="text-sm text-gray-600 cursor-pointer">
                        Confirmo el env√≠o de la informaci√≥n disponible para iniciar el tr√°mite.
                    </label>
                </div>
            </div>

            <div class="bg-gray-50 px-6 py-4 rounded-b-lg flex justify-end gap-3 border-t">
                <button type="button" onclick="cerrarModal('modal-envio')" class="px-4 py-2 border rounded-lg">Cancelar</button>
                <button type="submit" class="px-6 py-2 bg-[#1F6FB2] text-white rounded-lg hover:bg-blue-700">Enviar Correo</button>
            </div>
        </form>
    </div>
</div>

<div id="modal-revision" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-lg shadow-2xl max-w-xl w-full">
        <div class="bg-[#1F6FB2] text-white p-6 rounded-t-lg flex items-center justify-between">
            <h2 class="text-xl font-semibold">üîç En Revisi√≥n</h2>
            <button type="button" onclick="cerrarModal('modal-revision')" class="p-1 hover:bg-white hover:bg-opacity-20 rounded-lg">‚úï</button>
        </div>

        <form method="POST" action="{% url 'marcar_revision' siniestro.id %}">
            {% csrf_token %}
            <div class="p-6 space-y-4">
                <p class="text-gray-700">
                    Utilice esta opci√≥n cuando la aseguradora haya confirmado la recepci√≥n del caso o haya iniciado el an√°lisis.
                </p>
                <div>
                    <label class="block text-sm text-gray-600 mb-2">Nota Interna (Opcional)</label>
                    <textarea name="nota" rows="2" class="w-full border rounded-lg p-2"></textarea>
                </div>
            </div>
            <div class="bg-gray-50 px-6 py-4 rounded-b-lg flex justify-end gap-3 border-t">
                <button type="button" onclick="cerrarModal('modal-revision')" class="px-4 py-2 border rounded-lg">Cancelar</button>
                <button type="submit" class="px-6 py-2 bg-[#1F6FB2] text-white rounded-lg hover:bg-blue-700">Confirmar</button>
            </div>
        </form>
    </div>
</div>

<div id="modal-rechazar" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-lg shadow-2xl max-w-2xl w-full">
        <div class="bg-[#C0392B] text-white p-6 rounded-t-lg flex items-center justify-between">
            <h2 class="text-xl font-semibold">‚ùå Rechazar Siniestro</h2>
            <button type="button" onclick="cerrarModal('modal-rechazar')" class="p-1 hover:bg-white hover:bg-opacity-20 rounded-lg">‚úï</button>
        </div>

        <form method="POST" action="{% url 'rechazar_siniestro' siniestro.id %}">
            {% csrf_token %}
            <div class="p-6 space-y-6">
                <div class="bg-red-50 border border-red-200 rounded-lg p-4 flex gap-3">
                    <span class="text-2xl text-red-600">‚ö†Ô∏è</span>
                    <p class="text-sm text-gray-800">
                        Esta acci√≥n es irreversible. El siniestro pasar√° a estado <strong>RECHAZADO</strong> y se notificar√° al usuario.
                    </p>
                </div>

                <div>
                    <label class="block text-sm text-gray-600 mb-2">Raz√≥n del Rechazo *</label>
                    <select name="razon_rechazo" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-red-500 bg-white">
                        <option value="">Seleccione...</option>
                        <option value="Fuera de cobertura">Evento fuera de cobertura</option>
                        <option value="Deducible mayor al da√±o">Deducible mayor al da√±o</option>
                        <option value="Documentaci√≥n falsa">Documentaci√≥n inconsistente</option>
                        <option value="Fuera de plazo">Reportado fuera de plazo</option>
                        <option value="Otros">Otros</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm text-gray-600 mb-2">Detalle para el cliente *</label>
                    <textarea name="detalles" rows="4" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-red-500" required placeholder="Explique claramente por qu√© se rechaza..."></textarea>
                </div>
            </div>

            <div class="bg-gray-50 px-6 py-4 rounded-b-lg flex justify-end gap-3 border-t">
                <button type="button" onclick="cerrarModal('modal-rechazar')" class="px-4 py-2 border rounded-lg">Cancelar</button>
                <button type="submit" class="px-6 py-2 bg-[#C0392B] text-white rounded-lg hover:bg-red-700">Confirmar Rechazo</button>
            </div>
        </form>
    </div>
</div>

<div id="modal-aprobar" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-lg shadow-2xl max-w-2xl w-full">
        <div class="bg-[#2E8B57] text-white p-6 rounded-t-lg flex items-center justify-between">
            <h2 class="text-xl font-semibold">‚úÖ Aprobar Cobertura</h2>
            <button type="button" onclick="cerrarModal('modal-aprobar')" class="p-1 hover:bg-white hover:bg-opacity-20 rounded-lg">‚úï</button>
        </div>

        <form method="POST" action="{% url 'aprobar_siniestro' siniestro.id %}">
            {% csrf_token %}
            <div class="p-6 space-y-6">
                <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                    <p class="text-sm text-gray-800">
                        La aseguradora ha confirmado que <strong>el evento S√ç tiene cobertura</strong>. 
                        <br><br>
                        Al confirmar, el estado pasar√° a <strong>APROBADO</strong>. En el siguiente paso (Liquidaci√≥n) se registrar√°n los valores monetarios finales.
                    </p>
                </div>

                <div>
                    <label class="block text-sm text-gray-600 mb-2">Observaciones de la Aseguradora</label>
                    <textarea name="observaciones" rows="4" class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#2E8B57]" required placeholder="Ej: Cobertura aceptada seg√∫n carta de fecha..."></textarea>
                </div>
            </div>

            <div class="bg-gray-50 px-6 py-4 rounded-b-lg flex justify-end gap-3 border-t">
                <button type="button" onclick="cerrarModal('modal-aprobar')" class="px-4 py-2 border rounded-lg">Cancelar</button>
                <button type="submit" class="px-6 py-2 bg-[#2E8B57] text-white rounded-lg hover:bg-green-700">Confirmar Cobertura</button>
            </div>
        </form>
    </div>
</div>

<div id="modal-liquidar" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-lg shadow-2xl max-w-3xl w-full">
        <div class="bg-[#1F6FB2] text-white p-6 rounded-t-lg flex items-center justify-between">
            <h2 class="text-xl font-semibold">üí∞ Registrar Liquidaci√≥n</h2>
            <button type="button" onclick="cerrarModal('modal-liquidar')" class="p-1 hover:bg-white hover:bg-opacity-20 rounded-lg">‚úï</button>
        </div>

        <form method="POST" action="{% url 'liquidar_siniestro' siniestro.id %}" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="p-6 space-y-6">
                
                <div class="flex items-center gap-2 mb-2">
                    <span class="text-2xl">üßÆ</span>
                    <p class="text-sm text-gray-600">Ingrese los valores finales dictaminados por la aseguradora.</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm text-gray-600 mb-2 font-medium">Monto Aprobado (Aseguradora) *</label>
                        <div class="relative">
                            <span class="absolute left-3 top-2 text-gray-500">$</span>
                            <input type="number" step="0.01" name="monto_aprobado" id="input-monto" required
                                   class="w-full pl-8 pr-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 text-lg font-semibold"
                                   oninput="calcularLiquidacion()">
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm text-gray-600 mb-2 font-medium">Deducible Aplicado *</label>
                        <div class="relative">
                            <span class="absolute left-3 top-2 text-gray-500">$</span>
                            <input type="number" step="0.01" name="deducible" id="input-deducible" required
                                   class="w-full pl-8 pr-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 text-lg font-semibold text-red-600"
                                   oninput="calcularLiquidacion()">
                        </div>
                    </div>

                    <div class="col-span-1 md:col-span-2 bg-blue-50 p-4 rounded-lg flex justify-between items-center border border-blue-200 shadow-inner">
                        <div>
                            <span class="block font-semibold text-blue-900">Total a Pagar al Usuario:</span>
                            <span class="text-xs text-blue-600">(Monto Aprobado - Deducible)</span>
                        </div>
                        <span class="text-3xl font-bold text-blue-700" id="display-total">$ 0.00</span>
                    </div>
                </div>

                <div class="border-t pt-4">
                    <label class="block text-sm text-gray-600 mb-2 font-medium">Documento de Liquidaci√≥n (PDF) *</label>
                    <input type="file" name="documento_liquidacion" required accept=".pdf"
                           class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 cursor-pointer">
                </div>
            </div>

            <div class="bg-gray-50 px-6 py-4 rounded-b-lg flex justify-end gap-3 border-t">
                <button type="button" onclick="cerrarModal('modal-liquidar')" class="px-4 py-2 border rounded-lg">Cancelar</button>
                <button type="submit" class="px-6 py-2 bg-[#1F6FB2] text-white rounded-lg hover:bg-blue-700">Guardar Liquidaci√≥n</button>
            </div>
        </form>
    </div>
</div>

<div id="modal-pago" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-lg shadow-2xl max-w-2xl w-full">
        <div class="bg-[#2E8B57] text-white p-6 rounded-t-lg flex items-center justify-between">
            <h2 class="text-xl font-semibold">üí≥ Registrar Pago</h2>
            <button type="button" onclick="cerrarModal('modal-pago')" class="p-1 hover:bg-white hover:bg-opacity-20 rounded-lg">‚úï</button>
        </div>

        <form method="POST" action="{% url 'registrar_pago' siniestro.id %}" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="p-6 space-y-6">
                <div class="bg-green-50 p-4 rounded-lg text-center border border-green-200">
                    <span class="text-sm text-gray-600">Monto a Transferir</span>
                    <div class="text-3xl font-bold text-green-700">${{ siniestro.monto_a_pagar|default:"0.00" }}</div>
                </div>

                <div>
                    <label class="block text-sm text-gray-600 mb-2">Fecha de Pago *</label>
                    <input type="date" name="fecha_pago" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-green-500">
                </div>

                <div>
                    <label class="block text-sm text-gray-600 mb-2">Comprobante de Transferencia (PDF/IMG) *</label>
                    <input type="file" name="comprobante_pago" required class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-green-50 file:text-green-700 hover:file:bg-green-100">
                </div>
            </div>

            <div class="bg-gray-50 px-6 py-4 rounded-b-lg flex justify-end gap-3 border-t">
                <button type="button" onclick="cerrarModal('modal-pago')" class="px-4 py-2 border rounded-lg">Cancelar</button>
                <button type="submit" class="px-6 py-2 bg-[#2E8B57] text-white rounded-lg hover:bg-green-700">Confirmar Pago</button>
            </div>
        </form>
    </div>
</div>

<div id="modal-cerrar" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-lg shadow-2xl max-w-xl w-full">
        <div class="bg-[#0B3C5D] text-white p-6 rounded-t-lg flex items-center justify-between">
            <h2 class="text-xl font-semibold">üîí Cerrar Siniestro</h2>
            <button type="button" onclick="cerrarModal('modal-cerrar')" class="p-1 hover:bg-white hover:bg-opacity-20 rounded-lg">‚úï</button>
        </div>

        <form method="POST" action="{% url 'cerrar_siniestro' siniestro.id %}">
            {% csrf_token %}
            <div class="p-6 space-y-6">
                <div class="text-center">
                    <div class="w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center mx-auto mb-4">
                        <span class="text-3xl">üèÅ</span>
                    </div>
                    <h3 class="text-lg font-bold text-gray-800">¬øDesea cerrar el caso #{{ siniestro.id }}?</h3>
                    <p class="text-sm text-gray-600 mt-2">
                        Al cerrar el siniestro, este quedar√° archivado como finalizado y ya no podr√° ser modificado.
                        <br>
                        <strong>Aseg√∫rese de que el usuario ya recibi√≥ el pago.</strong>
                    </p>
                </div>

                <div class="flex items-center justify-center gap-2 mt-4">
                    <input type="checkbox" required id="check_cerrar" class="w-5 h-5 text-blue-900 rounded cursor-pointer">
                    <label for="check_cerrar" class="text-sm text-gray-800 cursor-pointer font-medium">S√≠, cerrar definitivamente</label>
                </div>
            </div>

            <div class="bg-gray-50 px-6 py-4 rounded-b-lg flex justify-end gap-3 border-t">
                <button type="button" onclick="cerrarModal('modal-cerrar')" class="px-4 py-2 border rounded-lg">Cancelar</button>
                <button type="submit" class="px-6 py-2 bg-[#0B3C5D] text-white rounded-lg hover:bg-slate-800">Cerrar Caso</button>
            </div>
        </form>
    </div>
</div>

<script>
    // L√≥gica de la calculadora para el Modal LIQUIDAR
    function calcularLiquidacion() {
        // Obtenemos los valores de los inputs dentro de modal-liquidar
        const inputMonto = document.getElementById('input-monto');
        const inputDeducible = document.getElementById('input-deducible');
        const displayTotal = document.getElementById('display-total');

        if (!inputMonto || !inputDeducible) return; // Seguridad

        const monto = parseFloat(inputMonto.value) || 0;
        const deducible = parseFloat(inputDeducible.value) || 0;
        
        // Evitamos n√∫meros negativos
        const total = Math.max(0, monto - deducible);
        
        // Formateo de moneda
        displayTotal.textContent = `$ ${total.toFixed(2)}`;
    }
</script>