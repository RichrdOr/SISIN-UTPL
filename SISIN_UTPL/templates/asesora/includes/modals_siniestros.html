<div id="modal-docs-incompletos" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-lg shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
        <div class="sticky top-0 bg-[#F2A900] text-white p-6 rounded-t-lg flex items-center justify-between z-10">
            <h2 class="text-xl font-semibold">‚ö†Ô∏è Documentaci√≥n Incompleta</h2>
            <button type="button" onclick="cerrarModal('modal-docs-incompletos')" class="p-1 hover:bg-white hover:bg-opacity-20 rounded-lg">‚úï</button>
        </div>

        <form method="POST" action="{% url 'marcar_docs_incompletos' siniestro.id %}">
            {% csrf_token %}
            <div class="p-6 space-y-6">
                <div class="bg-orange-50 border border-orange-200 rounded-lg p-4">
                    <p class="text-sm text-gray-800">
                        El siniestro pasar√° a estado <strong>Docs Incompletos</strong>. Se notificar√° al usuario para que subsane las observaciones.
                    </p>
                </div>

                <div>
                    <label class="block text-sm text-gray-600 mb-3 font-semibold">Seleccione los documentos faltantes:</label>
                    
                    <div class="space-y-2 mb-4">
                        <p class="text-xs text-gray-500 uppercase font-bold mb-2">üìÅ Documentos de Soporte</p>
                        <label class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-orange-50 transition-colors border border-transparent hover:border-orange-200">
                            <input type="checkbox" name="documentos_faltantes" value="carta" class="w-5 h-5 text-orange-500 rounded">
                            <div class="flex items-center gap-2">
                                <span class="text-lg">üìÑ</span>
                                <span class="text-sm font-medium">Carta Formal</span>
                            </div>
                        </label>
                        <label class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-orange-50 transition-colors border border-transparent hover:border-orange-200">
                            <input type="checkbox" name="documentos_faltantes" value="informe" class="w-5 h-5 text-orange-500 rounded">
                            <div class="flex items-center gap-2">
                                <span class="text-lg">üîß</span>
                                <span class="text-sm font-medium">Informe T√©cnico</span>
                            </div>
                        </label>
                        <label class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-orange-50 transition-colors border border-transparent hover:border-orange-200">
                            <input type="checkbox" name="documentos_faltantes" value="proforma" class="w-5 h-5 text-orange-500 rounded">
                            <div class="flex items-center gap-2">
                                <span class="text-lg">üßæ</span>
                                <span class="text-sm font-medium">Proforma de Reparaci√≥n</span>
                            </div>
                        </label>
                        <label class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-orange-50 transition-colors border border-transparent hover:border-orange-200">
                            <input type="checkbox" name="documentos_faltantes" value="preexistencia" class="w-5 h-5 text-orange-500 rounded">
                            <div class="flex items-center gap-2">
                                <span class="text-lg">‚úÖ</span>
                                <span class="text-sm font-medium">Certificado de Preexistencia</span>
                            </div>
                        </label>
                    </div>

                    {% if siniestro.tipo_evento == 'robo' %}
                    <div class="space-y-2 mb-4 pt-4 border-t">
                        <p class="text-xs text-red-500 uppercase font-bold mb-2">üö® Documentos de Robo</p>
                        <label class="flex items-center gap-3 p-3 bg-red-50 rounded-lg cursor-pointer hover:bg-red-100 transition-colors border border-transparent hover:border-red-200">
                            <input type="checkbox" name="documentos_faltantes" value="denuncia" class="w-5 h-5 text-red-500 rounded">
                            <div class="flex items-center gap-2">
                                <span class="text-lg">üö®</span>
                                <span class="text-sm font-medium">Denuncia Fiscal√≠a</span>
                            </div>
                        </label>
                    </div>
                    {% endif %}

                    <div class="space-y-2 pt-4 border-t">
                        <p class="text-xs text-gray-500 uppercase font-bold mb-2">üìã Otros</p>
                        <label class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-orange-50 transition-colors border border-transparent hover:border-orange-200">
                            <input type="checkbox" name="documentos_faltantes" value="cedula" class="w-5 h-5 text-orange-500 rounded">
                            <div class="flex items-center gap-2">
                                <span class="text-lg">ü™™</span>
                                <span class="text-sm font-medium">C√©dula / Identificaci√≥n</span>
                            </div>
                        </label>
                        <label class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-orange-50 transition-colors border border-transparent hover:border-orange-200">
                            <input type="checkbox" name="documentos_faltantes" value="facturas" class="w-5 h-5 text-orange-500 rounded">
                            <div class="flex items-center gap-2">
                                <span class="text-lg">üßæ</span>
                                <span class="text-sm font-medium">Facturas o Comprobantes</span>
                            </div>
                        </label>
                        <label class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-orange-50 transition-colors border border-transparent hover:border-orange-200">
                            <input type="checkbox" name="documentos_faltantes" value="fotos" class="w-5 h-5 text-orange-500 rounded">
                            <div class="flex items-center gap-2">
                                <span class="text-lg">üì∑</span>
                                <span class="text-sm font-medium">Fotograf√≠as del Siniestro</span>
                            </div>
                        </label>
                    </div>
                </div>

                <div>
                    <label class="block text-sm text-gray-600 mb-2">Mensaje adicional al Usuario</label>
                    <textarea name="observaciones" rows="3" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-orange-400" placeholder="Explique detalles adicionales o instrucciones espec√≠ficas..."></textarea>
                </div>
            </div>

            <div class="bg-gray-50 px-6 py-4 rounded-b-lg flex justify-end gap-3 border-t">
                <button type="button" onclick="cerrarModal('modal-docs-incompletos')" class="px-4 py-2 border rounded-lg">Cancelar</button>
                <button type="submit" class="px-6 py-2 bg-[#F2A900] text-white rounded-lg hover:bg-orange-600 font-medium">Notificar al Usuario</button>
            </div>
        </form>
    </div>
</div>

<div id="modal-docs-completos" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-lg shadow-2xl max-w-2xl w-full">
        <div class="bg-[#1F6FB2] text-white p-6 rounded-t-lg flex items-center justify-between">
            <h2 class="text-xl font-semibold">üìã Validar Documentaci√≥n</h2>
            <button type="button" onclick="cerrarModal('modal-docs-completos')" class="p-1 hover:bg-white hover:bg-opacity-20 rounded-lg">‚úï</button>
        </div>

        <form method="POST" action="{% url 'confirmar_documentos' siniestro.id %}">
            {% csrf_token %}
            <div class="p-6 space-y-6">
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <p class="text-sm text-gray-800">
                        Confirme que ha revisado los documentos cargados y que cumplen con los requisitos m√≠nimos para ser procesados.
                    </p>
                </div>

                <div>
                    <h4 class="text-sm font-semibold text-gray-700 mb-2">Documentos en sistema:</h4>
                    <ul class="space-y-2">
                        {% for doc in documentos %}
                        <li class="flex items-center text-sm text-gray-600">
                            <span class="text-green-500 mr-2">‚úî</span> {{ doc.tipo }}
                        </li>
                        {% empty %}
                        <li class="text-sm text-red-500 italic">No hay documentos cargados a√∫n.</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>

            <div class="bg-gray-50 px-6 py-4 rounded-b-lg flex justify-end gap-3 border-t">
                <button type="button" onclick="cerrarModal('modal-docs-completos')" class="px-4 py-2 border rounded-lg">Cancelar</button>
                <button type="submit" class="px-6 py-2 bg-[#1F6FB2] text-white rounded-lg hover:bg-blue-700">Validar y Continuar</button>
            </div>
        </form>
    </div>
</div>

<div id="modal-envio" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-lg shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto">
        <div class="sticky top-0 bg-[#0B3C5D] text-white p-6 rounded-t-lg flex items-center justify-between z-10">
            <h2 class="text-xl font-semibold">üì§ Enviar a Aseguradora</h2>
            <button type="button" onclick="cerrarModal('modal-envio')" class="p-1 hover:bg-white hover:bg-opacity-20 rounded-lg transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
        </div>

        <form method="POST" action="{% url 'enviar_aseguradora' siniestro.id %}">
            {% csrf_token %}
            <div class="p-6 space-y-6">
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 flex gap-3">
                    <span class="text-2xl">üìß</span>
                    <div>
                        <p class="text-sm text-gray-800">
                            Se enviar√° un correo oficial con la documentaci√≥n adjunta para iniciar el reclamo.
                        </p>
                    </div>
                </div>

                <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
                    <h4 class="text-sm font-bold text-gray-700 mb-3 border-b pb-2">Resumen del Caso</h4>
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div>
                            <span class="text-gray-500 block">N¬∫ Siniestro:</span>
                            <span class="font-medium text-gray-900">#{{ siniestro.numero_siniestro }}</span>
                        </div>
                        <div>
                            <span class="text-gray-500 block">P√≥liza:</span>
                            <span class="font-medium text-gray-900">{{ siniestro.poliza.numero_poliza }}</span>
                        </div>
                        <div>
                            <span class="text-gray-500 block">Asegurado:</span>
                            <span class="font-medium text-gray-900">{{ siniestro.reclamante_nombre }}</span>
                        </div>
                        <div>
                            <span class="text-gray-500 block">Aseguradora:</span>
                            <span class="font-medium text-gray-900">{{ siniestro.poliza.aseguradora }}</span>
                        </div>
                    </div>
                </div>

                <div>
                    <h4 class="text-sm font-semibold text-gray-700 mb-2">üìé Documentos Adjuntos al Correo:</h4>
                    <div class="border rounded-lg max-h-40 overflow-y-auto bg-gray-50 p-2 space-y-2">
                        {% for doc in siniestro.documentos.all %}
                        <div class="flex items-center gap-3 p-2 bg-white rounded border border-gray-200">
                            <svg class="w-5 h-5 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 2H7a2 2 0 00-2 2v15a2 2 0 002 2z"></path></svg>
                            <span class="text-sm text-gray-700">{{ doc.tipo }}</span>
                            <span class="text-xs text-gray-400 ml-auto">PDF</span>
                        </div>
                        {% empty %}
                        <div class="text-center text-sm text-orange-500 py-2 italic">
                            ‚ö†Ô∏è No hay documentos cargados. Se enviar√° solo la notificaci√≥n.
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1">
                        Destinatario (Aseguradora) <span class="text-red-500">*</span>
                    </label>
                    <div class="relative">
                        <span class="absolute left-3 top-2.5 text-gray-400">@</span>
                        <input type="email" 
                               name="correo_aseguradora" 
                               required
                               value="{{ form_enviar_aseguradora.initial.correo_aseguradora|default:'' }}"
                               placeholder="ej: siniestros@aseguradora.com"
                               class="w-full pl-8 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#0B3C5D] focus:border-[#0B3C5D] outline-none transition-all">
                    </div>
                    <p class="text-xs text-gray-500 mt-1">Puedes modificar este correo si es necesario.</p>
                </div>

                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1">Mensaje Adicional</label>
                    <textarea name="mensaje" rows="3" placeholder="A√±adir notas espec√≠ficas para el analista..." class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#0B3C5D] outline-none"></textarea>
                </div>

                <div class="flex items-start gap-2 pt-2">
                    <input type="checkbox" required id="check_envio_final" class="mt-1 w-4 h-4 text-[#0B3C5D] rounded cursor-pointer">
                    <label for="check_envio_final" class="text-sm text-gray-600 cursor-pointer select-none">
                        Confirmo que he revisado la informaci√≥n y autorizo el env√≠o.
                    </label>
                </div>
            </div>

            <div class="bg-gray-50 px-6 py-4 rounded-b-lg flex justify-end gap-3 border-t">
                <button type="button" onclick="cerrarModal('modal-envio')" class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-white transition-colors">
                    Cancelar
                </button>
                <button type="submit" class="flex items-center gap-2 px-6 py-2 bg-[#0B3C5D] text-white rounded-lg hover:bg-[#082A42] font-medium shadow-md transition-all">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg>
                    Enviar Correo
                </button>
            </div>
        </form>
    </div>
</div>

<div id="modal-revision" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-lg shadow-2xl max-w-xl w-full">
        <div class="bg-[#1F6FB2] text-white p-6 rounded-t-lg flex items-center justify-between">
            <h2 class="text-xl font-semibold">üîç En Revisi√≥n</h2>
            <button type="button" onclick="cerrarModal('modal-revision')" class="p-1 hover:bg-white hover:bg-opacity-20 rounded-lg">‚úï</button>
        </div>

        <form method="POST" action="{% url 'marcar_revision' siniestro.id %}">
            {% csrf_token %}
            <div class="p-6 space-y-4">
                <p class="text-gray-700">
                    Utilice esta opci√≥n cuando la aseguradora haya confirmado la recepci√≥n del caso o haya iniciado el an√°lisis.
                </p>
                <div>
                    <label class="block text-sm text-gray-600 mb-2">Nota Interna (Opcional)</label>
                    <textarea name="nota" rows="2" class="w-full border rounded-lg p-2"></textarea>
                </div>
            </div>
            <div class="bg-gray-50 px-6 py-4 rounded-b-lg flex justify-end gap-3 border-t">
                <button type="button" onclick="cerrarModal('modal-revision')" class="px-4 py-2 border rounded-lg">Cancelar</button>
                <button type="submit" class="px-6 py-2 bg-[#1F6FB2] text-white rounded-lg hover:bg-blue-700">Confirmar</button>
            </div>
        </form>
    </div>
</div>

<div id="modal-rechazar" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-lg shadow-2xl max-w-2xl w-full">
        <div class="bg-[#C0392B] text-white p-6 rounded-t-lg flex items-center justify-between">
            <h2 class="text-xl font-semibold">‚ùå Rechazar Siniestro</h2>
            <button type="button" onclick="cerrarModal('modal-rechazar')" class="p-1 hover:bg-white hover:bg-opacity-20 rounded-lg">‚úï</button>
        </div>

        <form method="POST" action="{% url 'rechazar_siniestro' siniestro.id %}">
            {% csrf_token %}
            <div class="p-6 space-y-6">
                <div class="bg-red-50 border border-red-200 rounded-lg p-4 flex gap-3">
                    <span class="text-2xl text-red-600">‚ö†Ô∏è</span>
                    <p class="text-sm text-gray-800">
                        Esta acci√≥n es irreversible. El siniestro pasar√° a estado <strong>RECHAZADO</strong> y se notificar√° al usuario.
                    </p>
                </div>

                <div>
                    <label class="block text-sm text-gray-600 mb-2">Raz√≥n del Rechazo *</label>
                    <select name="razon_rechazo" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-red-500 bg-white">
                        <option value="">Seleccione...</option>
                        <option value="Fuera de cobertura">Evento fuera de cobertura</option>
                        <option value="Deducible mayor al da√±o">Deducible mayor al da√±o</option>
                        <option value="Documentaci√≥n falsa">Documentaci√≥n inconsistente</option>
                        <option value="Fuera de plazo">Reportado fuera de plazo</option>
                        <option value="Otros">Otros</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm text-gray-600 mb-2">Detalle para el cliente *</label>
                    <textarea name="detalles" rows="4" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-red-500" required placeholder="Explique claramente por qu√© se rechaza..."></textarea>
                </div>
            </div>

            <div class="bg-gray-50 px-6 py-4 rounded-b-lg flex justify-end gap-3 border-t">
                <button type="button" onclick="cerrarModal('modal-rechazar')" class="px-4 py-2 border rounded-lg">Cancelar</button>
                <button type="submit" class="px-6 py-2 bg-[#C0392B] text-white rounded-lg hover:bg-red-700">Confirmar Rechazo</button>
            </div>
        </form>
    </div>
</div>

<div id="modal-aprobar" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-lg shadow-2xl max-w-2xl w-full">
        <div class="bg-[#2E8B57] text-white p-6 rounded-t-lg flex items-center justify-between">
            <h2 class="text-xl font-semibold">‚úÖ Aprobar Cobertura</h2>
            <button type="button" onclick="cerrarModal('modal-aprobar')" class="p-1 hover:bg-white hover:bg-opacity-20 rounded-lg">‚úï</button>
        </div>

        <form method="POST" action="{% url 'aprobar_siniestro' siniestro.id %}">
            {% csrf_token %}
            <div class="p-6 space-y-6">
                <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                    <p class="text-sm text-gray-800">
                        La aseguradora ha confirmado que <strong>el evento S√ç tiene cobertura</strong>. 
                        <br><br>
                        Al confirmar, el estado pasar√° a <strong>APROBADO</strong>. En el siguiente paso (Liquidaci√≥n) se registrar√°n los valores monetarios finales.
                    </p>
                </div>

                <div>
                    <label class="block text-sm text-gray-600 mb-2">Observaciones de la Aseguradora</label>
                    <textarea name="observaciones" rows="4" class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#2E8B57]" required placeholder="Ej: Cobertura aceptada seg√∫n carta de fecha..."></textarea>
                </div>
            </div>

            <div class="bg-gray-50 px-6 py-4 rounded-b-lg flex justify-end gap-3 border-t">
                <button type="button" onclick="cerrarModal('modal-aprobar')" class="px-4 py-2 border rounded-lg">Cancelar</button>
                <button type="submit" class="px-6 py-2 bg-[#2E8B57] text-white rounded-lg hover:bg-green-700">Confirmar Cobertura</button>
            </div>
        </form>
    </div>
</div>

<div id="modal-liquidar" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-lg shadow-2xl max-w-3xl w-full">
        <div class="bg-[#1F6FB2] text-white p-6 rounded-t-lg flex items-center justify-between">
            <h2 class="text-xl font-semibold">üí∞ Registrar Liquidaci√≥n</h2>
            <button type="button" onclick="cerrarModal('modal-liquidar')" class="p-1 hover:bg-white hover:bg-opacity-20 rounded-lg">‚úï</button>
        </div>

        <form method="POST" action="{% url 'liquidar_siniestro' siniestro.id %}" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="p-6 space-y-6">
                
                <div class="flex items-center gap-2 mb-2">
                    <span class="text-2xl">üßÆ</span>
                    <p class="text-sm text-gray-600">Ingrese los valores finales dictaminados por la aseguradora.</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm text-gray-600 mb-2 font-medium">Monto Aprobado (Aseguradora) *</label>
                        <div class="relative">
                            <span class="absolute left-3 top-2 text-gray-500">$</span>
                            <input type="number" step="0.01" name="monto_aprobado" id="input-monto" required
                                   class="w-full pl-8 pr-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 text-lg font-semibold"
                                   oninput="calcularLiquidacion()">
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm text-gray-600 mb-2 font-medium">Deducible Aplicado *</label>
                        <div class="relative">
                            <span class="absolute left-3 top-2 text-gray-500">$</span>
                            <input type="number" step="0.01" name="deducible" id="input-deducible" required
                                   class="w-full pl-8 pr-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 text-lg font-semibold text-red-600"
                                   oninput="calcularLiquidacion()">
                        </div>
                    </div>

                    <div class="col-span-1 md:col-span-2 bg-blue-50 p-4 rounded-lg flex justify-between items-center border border-blue-200 shadow-inner">
                        <div>
                            <span class="block font-semibold text-blue-900">Total a Pagar al Usuario:</span>
                            <span class="text-xs text-blue-600">(Monto Aprobado - Deducible)</span>
                        </div>
                        <span class="text-3xl font-bold text-blue-700" id="display-total">$ 0.00</span>
                    </div>
                </div>

                <div class="border-t pt-4">
                    <label class="block text-sm text-gray-600 mb-2 font-medium">Documento de Liquidaci√≥n (PDF) *</label>
                    <input type="file" name="documento_liquidacion" required accept=".pdf"
                           class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 cursor-pointer">
                </div>
            </div>

            <div class="bg-gray-50 px-6 py-4 rounded-b-lg flex justify-end gap-3 border-t">
                <button type="button" onclick="cerrarModal('modal-liquidar')" class="px-4 py-2 border rounded-lg">Cancelar</button>
                <button type="submit" class="px-6 py-2 bg-[#1F6FB2] text-white rounded-lg hover:bg-blue-700">Guardar Liquidaci√≥n</button>
            </div>
        </form>
    </div>
</div>

<div id="modal-pago" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-lg shadow-2xl max-w-2xl w-full">
        <div class="bg-[#2E8B57] text-white p-6 rounded-t-lg flex items-center justify-between">
            <h2 class="text-xl font-semibold">üí≥ Registrar Pago</h2>
            <button type="button" onclick="cerrarModal('modal-pago')" class="p-1 hover:bg-white hover:bg-opacity-20 rounded-lg">‚úï</button>
        </div>

        <form method="POST" action="{% url 'registrar_pago' siniestro.id %}" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="p-6 space-y-6">
                <div class="bg-green-50 p-4 rounded-lg text-center border border-green-200">
                    <span class="text-sm text-gray-600">Monto a Transferir</span>
                    <div class="text-3xl font-bold text-green-700">${{ siniestro.monto_a_pagar|default:"0.00" }}</div>
                </div>

                <div>
                    <label class="block text-sm text-gray-600 mb-2">Fecha de Pago *</label>
                    <input type="date" name="fecha_pago" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-green-500">
                </div>

                <div>
                    <label class="block text-sm text-gray-600 mb-2">Comprobante de Transferencia (PDF o Imagen) *</label>
                    <input type="file" 
                           name="comprobante_pago" 
                           required 
                           accept=".pdf, .jpg, .jpeg, .png"
                           class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-green-50 file:text-green-700 hover:file:bg-green-100 cursor-pointer">
                    <p class="text-xs text-gray-500 mt-1">Formatos permitidos: PDF, JPG, PNG.</p>
                </div>

                <div>
                    <label class="block text-sm text-gray-600 mb-2">Observaciones (Opcional)</label>
                    <textarea name="observaciones" rows="2" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-green-500" placeholder="Ej: Transferencia #123456 Banco Pichincha"></textarea>
                </div>
            </div>

            <div class="bg-gray-50 px-6 py-4 rounded-b-lg flex justify-end gap-3 border-t">
                <button type="button" onclick="cerrarModal('modal-pago')" class="px-4 py-2 border rounded-lg">Cancelar</button>
                <button type="submit" class="px-6 py-2 bg-[#2E8B57] text-white rounded-lg hover:bg-green-700">Confirmar Pago</button>
            </div>
        </form>
    </div>
</div>

<div id="modal-cerrar" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-lg shadow-2xl max-w-xl w-full">
        <div class="bg-[#0B3C5D] text-white p-6 rounded-t-lg flex items-center justify-between">
            <h2 class="text-xl font-semibold">üîí Cerrar Siniestro</h2>
            <button type="button" onclick="cerrarModal('modal-cerrar')" class="p-1 hover:bg-white hover:bg-opacity-20 rounded-lg">‚úï</button>
        </div>

        <form method="POST" action="{% url 'cerrar_siniestro' siniestro.id %}">
            {% csrf_token %}
            <div class="p-6 space-y-6">
                <div class="text-center">
                    <div class="w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center mx-auto mb-4">
                        <span class="text-3xl">üèÅ</span>
                    </div>
                    <h3 class="text-lg font-bold text-gray-800">¬øDesea cerrar el caso #{{ siniestro.id }}?</h3>
                    <p class="text-sm text-gray-600 mt-2">
                        Al cerrar el siniestro, este quedar√° archivado como finalizado y ya no podr√° ser modificado.
                        <br>
                        <strong>Aseg√∫rese de que el usuario ya recibi√≥ el pago.</strong>
                    </p>
                </div>

                <div class="flex items-center justify-center gap-2 mt-4">
                    <input type="checkbox" required id="check_cerrar" class="w-5 h-5 text-blue-900 rounded cursor-pointer">
                    <label for="check_cerrar" class="text-sm text-gray-800 cursor-pointer font-medium">S√≠, cerrar definitivamente</label>
                </div>
            </div>

            <div class="bg-gray-50 px-6 py-4 rounded-b-lg flex justify-end gap-3 border-t">
                <button type="button" onclick="cerrarModal('modal-cerrar')" class="px-4 py-2 border rounded-lg">Cancelar</button>
                <button type="submit" class="px-6 py-2 bg-[#0B3C5D] text-white rounded-lg hover:bg-slate-800">Cerrar Caso</button>
            </div>
        </form>
    </div>
</div>

<script>
    // L√≥gica de la calculadora para el Modal LIQUIDAR
    function calcularLiquidacion() {
        // Obtenemos los valores de los inputs dentro de modal-liquidar
        const inputMonto = document.getElementById('input-monto');
        const inputDeducible = document.getElementById('input-deducible');
        const displayTotal = document.getElementById('display-total');

        if (!inputMonto || !inputDeducible) return; // Seguridad

        const monto = parseFloat(inputMonto.value) || 0;
        const deducible = parseFloat(inputDeducible.value) || 0;
        
        // Evitamos n√∫meros negativos
        const total = Math.max(0, monto - deducible);
        
        // Formateo de moneda
        displayTotal.textContent = `$ ${total.toFixed(2)}`;
    }
</script>