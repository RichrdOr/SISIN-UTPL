<div id="modal-docs-incompletos" style="backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); background-color: rgba(0,0,0,0.2);" class="hidden fixed inset-0 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-lg shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
        <div class="sticky top-0 bg-[#F2A900] text-white p-6 rounded-t-lg flex items-center justify-between z-10">
            <h2 class="text-xl font-semibold">‚ö†Ô∏è Documentaci√≥n Incompleta</h2>
            <button type="button" onclick="cerrarModal('modal-docs-incompletos')" class="p-1 hover:bg-white hover:bg-opacity-20 rounded-lg">‚úï</button>
        </div>

        <form method="POST" action="{% url 'marcar_docs_incompletos' siniestro.id %}">
            {% csrf_token %}
            <div class="p-6 space-y-6">
                <div class="bg-orange-50 border border-orange-200 rounded-lg p-4">
                    <p class="text-sm text-gray-800">
                        El siniestro pasar√° a estado <strong>Docs Incompletos</strong>. Se notificar√° al usuario para que subsane las observaciones.
                    </p>
                </div>

                <div>
                    <label class="block text-sm text-gray-600 mb-3 font-semibold">Seleccione los documentos faltantes:</label>
                    
                    <div class="space-y-2 mb-4">
                        <p class="text-xs text-gray-500 uppercase font-bold mb-2">üìÅ Documentos de Soporte</p>
                        <label class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-orange-50 transition-colors border border-transparent hover:border-orange-200">
                            <input type="checkbox" name="documentos_faltantes" value="carta" class="w-5 h-5 text-orange-500 rounded">
                            <div class="flex items-center gap-2">
                                <span class="text-lg">üìÑ</span>
                                <span class="text-sm font-medium">Carta Formal</span>
                            </div>
                        </label>
                        <label class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-orange-50 transition-colors border border-transparent hover:border-orange-200">
                            <input type="checkbox" name="documentos_faltantes" value="informe" class="w-5 h-5 text-orange-500 rounded">
                            <div class="flex items-center gap-2">
                                <span class="text-lg">üîß</span>
                                <span class="text-sm font-medium">Informe T√©cnico</span>
                            </div>
                        </label>
                        <label class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-orange-50 transition-colors border border-transparent hover:border-orange-200">
                            <input type="checkbox" name="documentos_faltantes" value="proforma" class="w-5 h-5 text-orange-500 rounded">
                            <div class="flex items-center gap-2">
                                <span class="text-lg">üßæ</span>
                                <span class="text-sm font-medium">Proforma de Reparaci√≥n</span>
                            </div>
                        </label>
                        <label class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-orange-50 transition-colors border border-transparent hover:border-orange-200">
                            <input type="checkbox" name="documentos_faltantes" value="preexistencia" class="w-5 h-5 text-orange-500 rounded">
                            <div class="flex items-center gap-2">
                                <span class="text-lg">‚úÖ</span>
                                <span class="text-sm font-medium">Certificado de Preexistencia</span>
                            </div>
                        </label>
                    </div>

                    {% if siniestro.tipo_evento == 'robo' %}
                    <div class="space-y-2 mb-4 pt-4 border-t">
                        <p class="text-xs text-red-500 uppercase font-bold mb-2">üö® Documentos de Robo</p>
                        <label class="flex items-center gap-3 p-3 bg-red-50 rounded-lg cursor-pointer hover:bg-red-100 transition-colors border border-transparent hover:border-red-200">
                            <input type="checkbox" name="documentos_faltantes" value="denuncia" class="w-5 h-5 text-red-500 rounded">
                            <div class="flex items-center gap-2">
                                <span class="text-lg">üö®</span>
                                <span class="text-sm font-medium">Denuncia Fiscal√≠a</span>
                            </div>
                        </label>
                    </div>
                    {% endif %}

                    <div class="space-y-2 pt-4 border-t">
                        <p class="text-xs text-gray-500 uppercase font-bold mb-2">üìã Otros</p>
                        <label class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-orange-50 transition-colors border border-transparent hover:border-orange-200">
                            <input type="checkbox" name="documentos_faltantes" value="cedula" class="w-5 h-5 text-orange-500 rounded">
                            <div class="flex items-center gap-2">
                                <span class="text-lg">ü™™</span>
                                <span class="text-sm font-medium">C√©dula / Identificaci√≥n</span>
                            </div>
                        </label>
                        <label class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-orange-50 transition-colors border border-transparent hover:border-orange-200">
                            <input type="checkbox" name="documentos_faltantes" value="facturas" class="w-5 h-5 text-orange-500 rounded">
                            <div class="flex items-center gap-2">
                                <span class="text-lg">üßæ</span>
                                <span class="text-sm font-medium">Facturas o Comprobantes</span>
                            </div>
                        </label>
                        <label class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-orange-50 transition-colors border border-transparent hover:border-orange-200">
                            <input type="checkbox" name="documentos_faltantes" value="fotos" class="w-5 h-5 text-orange-500 rounded">
                            <div class="flex items-center gap-2">
                                <span class="text-lg">üì∑</span>
                                <span class="text-sm font-medium">Fotograf√≠as del Siniestro</span>
                            </div>
                        </label>
                    </div>
                </div>

                <div>
                    <label class="block text-sm text-gray-600 mb-2">Mensaje adicional al Usuario</label>
                    <textarea name="observaciones" rows="3" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-orange-400" placeholder="Explique detalles adicionales o instrucciones espec√≠ficas..."></textarea>
                </div>
            </div>

            <div class="bg-gray-50 px-6 py-4 rounded-b-lg flex justify-end gap-3 border-t">
                <button type="button" onclick="cerrarModal('modal-docs-incompletos')" class="px-4 py-2 border rounded-lg">Cancelar</button>
                <button type="submit" class="px-6 py-2 bg-[#F2A900] text-white rounded-lg hover:bg-orange-600 font-medium">Notificar al Usuario</button>
            </div>
        </form>
    </div>
</div>

<div id="modal-docs-completos" style="backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); background-color: rgba(0,0,0,0.2);" class="hidden fixed inset-0 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-lg shadow-2xl max-w-2xl w-full">
        <div class="bg-[#1F6FB2] text-white p-6 rounded-t-lg flex items-center justify-between">
            <h2 class="text-xl font-semibold">üìã Validar Documentaci√≥n</h2>
            <button type="button" onclick="cerrarModal('modal-docs-completos')" class="p-1 hover:bg-white hover:bg-opacity-20 rounded-lg">‚úï</button>
        </div>

        <form method="POST" action="{% url 'confirmar_documentos' siniestro.id %}">
            {% csrf_token %}
            <div class="p-6 space-y-6">
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <p class="text-sm text-gray-800">
                        Confirme que ha revisado los documentos cargados y que cumplen con los requisitos m√≠nimos para ser procesados.
                    </p>
                </div>

                <div>
                    <h4 class="text-sm font-semibold text-gray-700 mb-2">Documentos en sistema:</h4>
                    <ul class="space-y-2">
                        {% for doc in documentos %}
                        <li class="flex items-center text-sm text-gray-600">
                            <span class="text-green-500 mr-2">‚úî</span> {{ doc.tipo }}
                        </li>
                        {% empty %}
                        <li class="text-sm text-red-500 italic">No hay documentos cargados a√∫n.</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>

            <div class="bg-gray-50 px-6 py-4 rounded-b-lg flex justify-end gap-3 border-t">
                <button type="button" onclick="cerrarModal('modal-docs-completos')" class="px-4 py-2 border rounded-lg">Cancelar</button>
                <button type="submit" class="px-6 py-2 bg-[#1F6FB2] text-white rounded-lg hover:bg-blue-700">Validar y Continuar</button>
            </div>
        </form>
    </div>
</div>

<!--
de fonfo negrito 
<div id="modal-envio" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    a borrocito :3
    
--> 

<div id="modal-envio" style="backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); background-color: rgba(0,0,0,0.2);" class="hidden fixed inset-0 flex items-center justify-center z-50 p-4">

    <div class="bg-white rounded-lg shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto">
        <div class="sticky top-0 bg-[#0B3C5D] text-white p-6 rounded-t-lg flex items-center justify-between z-10">
            <h2 class="text-xl font-semibold">üì§ Enviar a Aseguradora</h2>
            <button type="button" onclick="cerrarModal('modal-envio')" class="p-1 hover:bg-white hover:bg-opacity-20 rounded-lg transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
        </div>

        <form method="POST" action="{% url 'enviar_aseguradora' siniestro.id %}">
            {% csrf_token %}
            <div class="p-6 space-y-6">
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 flex gap-3">
                    <span class="text-2xl">üìß</span>
                    <div>
                        <p class="text-sm text-gray-800">
                            Se enviar√° un correo oficial con la documentaci√≥n adjunta para iniciar el reclamo.
                        </p>
                    </div>
                </div>

                <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
                    <h4 class="text-sm font-bold text-gray-700 mb-3 border-b pb-2">Resumen del Caso</h4>
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div>
                            <span class="text-gray-500 block">N¬∫ Siniestro:</span>
                            <span class="font-medium text-gray-900">#{{ siniestro.numero_siniestro }}</span>
                        </div>
                        <div>
                            <span class="text-gray-500 block">P√≥liza:</span>
                            <span class="font-medium text-gray-900">{{ siniestro.poliza.numero_poliza }}</span>
                        </div>
                        <div>
                            <span class="text-gray-500 block">Asegurado:</span>
                            <span class="font-medium text-gray-900">{{ siniestro.reclamante_nombre }}</span>
                        </div>
                        <div>
                            <span class="text-gray-500 block">Aseguradora:</span>
                            <span class="font-medium text-gray-900">{{ siniestro.poliza.aseguradora }}</span>
                        </div>
                    </div>
                </div>

                <div>
                    <h4 class="text-sm font-semibold text-gray-700 mb-2">üìé Documentos Adjuntos al Correo:</h4>
                    <div class="border rounded-lg max-h-40 overflow-y-auto bg-gray-50 p-2 space-y-2">
                        {% for doc in siniestro.documentos.all %}
                        <div class="flex items-center gap-3 p-2 bg-white rounded border border-gray-200">
                            <svg class="w-5 h-5 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 2H7a2 2 0 00-2 2v15a2 2 0 002 2z"></path></svg>
                            <span class="text-sm text-gray-700">{{ doc.tipo }}</span>
                            <span class="text-xs text-gray-400 ml-auto">PDF</span>
                        </div>
                        {% empty %}
                        <div class="text-center text-sm text-orange-500 py-2 italic">
                            ‚ö†Ô∏è No hay documentos cargados. Se enviar√° solo la notificaci√≥n.
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1">
                        Destinatario (Aseguradora) <span class="text-red-500">*</span>
                    </label>
                    <div class="relative">
                        <span class="absolute left-3 top-2.5 text-gray-400">@</span>
                        <input type="email" 
                               name="correo_aseguradora" 
                               required
                               value="{{ form_enviar_aseguradora.initial.correo_aseguradora|default:'' }}"
                               placeholder="ej: siniestros@aseguradora.com"
                               class="w-full pl-8 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#0B3C5D] focus:border-[#0B3C5D] outline-none transition-all">
                    </div>
                    <p class="text-xs text-gray-500 mt-1">Puedes modificar este correo si es necesario.</p>
                </div>

                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1">Mensaje Adicional</label>
                    <textarea name="mensaje" rows="3" placeholder="A√±adir notas espec√≠ficas para el analista..." class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#0B3C5D] outline-none"></textarea>
                </div>

                <div class="flex items-start gap-2 pt-2">
                    <input type="checkbox" required id="check_envio_final" class="mt-1 w-4 h-4 text-[#0B3C5D] rounded cursor-pointer">
                    <label for="check_envio_final" class="text-sm text-gray-600 cursor-pointer select-none">
                        Confirmo que he revisado la informaci√≥n y autorizo el env√≠o.
                    </label>
                </div>
            </div>

            <div class="bg-gray-50 px-6 py-4 rounded-b-lg flex justify-end gap-3 border-t">
                <button type="button" onclick="cerrarModal('modal-envio')" class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-white transition-colors">
                    Cancelar
                </button>
                <button type="submit" class="flex items-center gap-2 px-6 py-2 bg-[#0B3C5D] text-white rounded-lg hover:bg-[#082A42] font-medium shadow-md transition-all">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg>
                    Enviar Correo
                </button>
            </div>
        </form>
    </div>
</div>

<div id="modal-revision" style="backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); background-color: rgba(0,0,0,0.2);" class="hidden fixed inset-0 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-lg shadow-2xl max-w-xl w-full">
        <div class="bg-[#1F6FB2] text-white p-6 rounded-t-lg flex items-center justify-between">
            <h2 class="text-xl font-semibold">üîç En Revisi√≥n</h2>
            <button type="button" onclick="cerrarModal('modal-revision')" class="p-1 hover:bg-white hover:bg-opacity-20 rounded-lg">‚úï</button>
        </div>

        <form method="POST" action="{% url 'marcar_revision' siniestro.id %}">
            {% csrf_token %}
            <div class="p-6 space-y-4">
                <p class="text-gray-700">
                    Utilice esta opci√≥n cuando la aseguradora haya confirmado la recepci√≥n del caso o haya iniciado el an√°lisis.
                </p>
                <div>
                    <label class="block text-sm text-gray-600 mb-2">Nota Interna (Opcional)</label>
                    <textarea name="nota" rows="2" class="w-full border rounded-lg p-2"></textarea>
                </div>
            </div>
            <div class="bg-gray-50 px-6 py-4 rounded-b-lg flex justify-end gap-3 border-t">
                <button type="button" onclick="cerrarModal('modal-revision')" class="px-4 py-2 border rounded-lg">Cancelar</button>
                <button type="submit" class="px-6 py-2 bg-[#1F6FB2] text-white rounded-lg hover:bg-blue-700">Confirmar</button>
            </div>
        </form>
    </div>
</div>

<div id="modal-rechazar" style="backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); background-color: rgba(0,0,0,0.2);" class="hidden fixed inset-0 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-lg shadow-2xl max-w-2xl w-full">
        <div class="bg-[#C0392B] text-white p-6 rounded-t-lg flex items-center justify-between">
            <h2 class="text-xl font-semibold">‚ùå Rechazar Siniestro</h2>
            <button type="button" onclick="cerrarModal('modal-rechazar')" class="p-1 hover:bg-white hover:bg-opacity-20 rounded-lg">‚úï</button>
        </div>

        <form method="POST" action="{% url 'rechazar_siniestro' siniestro.id %}">
            {% csrf_token %}
            <div class="p-6 space-y-6">
                <div class="bg-red-50 border border-red-200 rounded-lg p-4 flex gap-3">
                    <span class="text-2xl text-red-600">‚ö†Ô∏è</span>
                    <p class="text-sm text-gray-800">
                        Esta acci√≥n es irreversible. El siniestro pasar√° a estado <strong>RECHAZADO</strong> y se notificar√° al usuario.
                    </p>
                </div>

                <div>
                    <label class="block text-sm text-gray-600 mb-2">Raz√≥n del Rechazo *</label>
                    <select name="razon_rechazo" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-red-500 bg-white">
                        <option value="">Seleccione...</option>
                        <option value="Fuera de cobertura">Evento fuera de cobertura</option>
                        <option value="Deducible mayor al da√±o">Deducible mayor al da√±o</option>
                        <option value="Documentaci√≥n falsa">Documentaci√≥n inconsistente</option>
                        <option value="Fuera de plazo">Reportado fuera de plazo</option>
                        <option value="Otros">Otros</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm text-gray-600 mb-2">Detalle para el cliente *</label>
                    <textarea name="detalles" rows="4" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-red-500" required placeholder="Explique claramente por qu√© se rechaza..."></textarea>
                </div>
            </div>

            <div class="bg-gray-50 px-6 py-4 rounded-b-lg flex justify-end gap-3 border-t">
                <button type="button" onclick="cerrarModal('modal-rechazar')" class="px-4 py-2 border rounded-lg">Cancelar</button>
                <button type="submit" class="px-6 py-2 bg-[#C0392B] text-white rounded-lg hover:bg-red-700">Confirmar Rechazo</button>
            </div>
        </form>
    </div>
</div>

<div id="modal-aprobar" style="backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); background-color: rgba(0,0,0,0.2);" class="hidden fixed inset-0 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-lg shadow-2xl max-w-2xl w-full">
        <div class="bg-[#2E8B57] text-white p-6 rounded-t-lg flex items-center justify-between">
            <h2 class="text-xl font-semibold">‚úÖ Aprobar Cobertura</h2>
            <button type="button" onclick="cerrarModal('modal-aprobar')" class="p-1 hover:bg-white hover:bg-opacity-20 rounded-lg">‚úï</button>
        </div>

        <form method="POST" action="{% url 'aprobar_siniestro' siniestro.id %}">
            {% csrf_token %}
            <div class="p-6 space-y-6">
                <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                    <p class="text-sm text-gray-800">
                        La aseguradora ha confirmado que <strong>el evento S√ç tiene cobertura</strong>. 
                        <br><br>
                        Al confirmar, el estado pasar√° a <strong>APROBADO</strong>. En el siguiente paso (Liquidaci√≥n) se registrar√°n los valores monetarios finales.
                    </p>
                </div>

                <div>
                    <label class="block text-sm text-gray-600 mb-2">Observaciones de la Aseguradora</label>
                    <textarea name="observaciones" rows="4" class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#2E8B57]" required placeholder="Ej: Cobertura aceptada seg√∫n carta de fecha..."></textarea>
                </div>
            </div>

            <div class="bg-gray-50 px-6 py-4 rounded-b-lg flex justify-end gap-3 border-t">
                <button type="button" onclick="cerrarModal('modal-aprobar')" class="px-4 py-2 border rounded-lg">Cancelar</button>
                <button type="submit" class="px-6 py-2 bg-[#2E8B57] text-white rounded-lg hover:bg-green-700">Confirmar Cobertura</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal Liquidar mejorado y piola para usar :3 -->

<!-- Modal LIQUIDAR -->
<div id="modal-liquidar" style="backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); background-color: rgba(0,0,0,0.2);" class="hidden fixed inset-0 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-lg shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
        <div class="bg-[#1F6FB2] text-white p-6 rounded-t-lg flex items-center justify-between sticky top-0 z-10">
            <h2 class="text-xl font-semibold">üí∞ Registrar Liquidaci√≥n</h2>
            <button type="button" onclick="cerrarModal('modal-liquidar')" class="p-1 hover:bg-white hover:bg-opacity-20 rounded-lg">‚úï</button>
        </div>

        <form method="POST" action="{% url 'liquidar_siniestro' siniestro.id %}" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="p-6 space-y-6">
                
                <!-- INFORMACI√ìN DEL RAMO -->
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <h4 class="font-semibold text-blue-900 mb-3 flex items-center gap-2">
                        <span>üìã</span> Informaci√≥n del Ramo
                    </h4>
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div>
                            <span class="text-blue-600 block">Ramo:</span>
                            <span class="font-semibold text-blue-900">{{ siniestro.ramo.ramo }}</span>
                        </div>
                        <div>
                            <span class="text-blue-600 block">% Deducible:</span>
                            <span class="font-semibold text-blue-900">{{ siniestro.ramo.deducible_porcentaje }}%</span>
                        </div>
                    </div>
                </div>

                <div class="flex items-center gap-2 mb-2">
                    <span class="text-2xl">üßÆ</span>
                    <p class="text-sm text-gray-600">Ingrese el monto aprobado por la aseguradora. El deducible se calcular√° autom√°ticamente.</p>
                </div>

                <div class="space-y-4">
                    <!-- MONTO APROBADO -->
                    <div>
                        <label class="block text-sm text-gray-600 mb-2 font-medium">
                            Monto Aprobado (Aseguradora) *
                        </label>
                        <div class="relative">
                            <span class="absolute left-3 top-2 text-gray-500">$</span>
                            <input type="number" step="0.01" name="monto_aprobado" id="input-monto" required
                                   class="w-full pl-8 pr-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 text-lg font-semibold"
                                   oninput="calcularDeducible()">
                        </div>
                    </div>

                    <!-- DEDUCIBLE APLICADO -->
                    <div>
                        <label class="block text-sm text-gray-600 mb-2 font-medium">
                            Deducible Aplicado ({{ siniestro.ramo.deducible_porcentaje }}%)
                        </label>
                        <div class="relative">
                            <span class="absolute left-3 top-2 text-gray-500">$</span>
                            <input type="number" step="0.01" name="deducible" id="input-deducible" required
                                   readonly
                                   class="w-full pl-8 pr-4 py-2 border rounded-lg bg-gray-50 text-lg font-semibold text-red-600 cursor-not-allowed"
                                   value="0.00">
                        </div>
                        <p class="text-xs text-gray-500 mt-1">
                            ‚úì Calculado autom√°ticamente desde la p√≥liza
                        </p>
                    </div>

                    <!-- TOTAL A PAGAR -->
                    <div class="bg-green-50 p-5 rounded-lg border-2 border-green-200 shadow-inner">
                        <div class="flex justify-between items-center">
                            <div>
                                <span class="block font-semibold text-green-900 text-lg">Total a Pagar al Usuario:</span>
                                <span class="text-xs text-green-700">(Monto Aprobado - Deducible)</span>
                            </div>
                            <span class="text-4xl font-bold text-green-700" id="display-total">$ 0.00</span>
                        </div>
                    </div>
                </div>

                <!-- DOCUMENTO PDF - COMPONENTE REUTILIZABLE -->
                <div class="upload-container" 
                     data-input-id="file-liquidacion" 
                     data-name="documento_liquidacion" 
                     data-accept=".pdf"
                     data-title="üìé Documento de Liquidaci√≥n *"
                     data-subtitle="Solo archivos PDF"
                     data-color="blue">
                </div>

                <input type="hidden" id="deducible-porcentaje" value="{{ siniestro.ramo.deducible_porcentaje }}">
            </div>

            <div class="bg-gray-50 px-6 py-4 rounded-b-lg flex justify-end gap-3 border-t sticky bottom-0">
                <button type="button" onclick="cerrarModal('modal-liquidar')" class="px-4 py-2 border rounded-lg hover:bg-gray-100 transition">Cancelar</button>
                <button type="submit" class="px-6 py-2 bg-[#1F6FB2] text-white rounded-lg hover:bg-blue-700 font-semibold transition">Guardar Liquidaci√≥n</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal PAGO mas bonito -->
<div id="modal-pago" style="backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); background-color: rgba(0,0,0,0.2);" class="hidden fixed inset-0 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-lg shadow-2xl max-w-2xl w-full">
        <div class="bg-[#2E8B57] text-white p-6 rounded-t-lg flex items-center justify-between">
            <h2 class="text-xl font-semibold">üí≥ Registrar Pago</h2>
            <button type="button" onclick="cerrarModal('modal-pago')" class="p-1 hover:bg-white hover:bg-opacity-20 rounded-lg">‚úï</button>
        </div>

        <form method="POST" action="{% url 'registrar_pago' siniestro.id %}" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="p-6 space-y-6">
                <div class="bg-green-50 p-4 rounded-lg text-center border border-green-200">
                    <span class="text-sm text-gray-600">Monto a Transferir</span>
                    <div class="text-3xl font-bold text-green-700">${{ siniestro.monto_a_pagar|default:"0.00" }}</div>
                </div>

                <div>
                    <label class="block text-sm text-gray-600 mb-2 font-medium">Fecha de Pago *</label>
                    <input type="date" name="fecha_pago" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-green-500">
                </div>

                <!-- COMPROBANTE - COMPONENTE REUTILIZABLE -->
                <div class="upload-container" 
                     data-input-id="file-pago" 
                     data-name="comprobante_pago" 
                     data-accept=".pdf,.jpg,.jpeg,.png"
                     data-title="üìÑ Comprobante de Transferencia *"
                     data-subtitle="PDF, JPG o PNG"
                     data-color="green">
                </div>

                <div>
                    <label class="block text-sm text-gray-600 mb-2">Observaciones (Opcional)</label>
                    <textarea name="observaciones" rows="2" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-green-500" placeholder="Ej: Transferencia #123456 Banco Pichincha"></textarea>
                </div>
            </div>

            <div class="bg-gray-50 px-6 py-4 rounded-b-lg flex justify-end gap-3 border-t">
                <button type="button" onclick="cerrarModal('modal-pago')" class="px-4 py-2 border rounded-lg hover:bg-gray-100 transition">Cancelar</button>
                <button type="submit" class="px-6 py-2 bg-[#2E8B57] text-white rounded-lg hover:bg-green-700 font-semibold transition">Confirmar Pago</button>
            </div>
        </form>
    </div>
</div>
 



<div id="modal-cerrar" style="backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); background-color: rgba(0,0,0,0.2);" class="hidden fixed inset-0 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-lg shadow-2xl max-w-xl w-full">
        <div class="bg-[#0B3C5D] text-white p-6 rounded-t-lg flex items-center justify-between">
            <h2 class="text-xl font-semibold">üîí Cerrar Siniestro</h2>
            <button type="button" onclick="cerrarModal('modal-cerrar')" class="p-1 hover:bg-white hover:bg-opacity-20 rounded-lg">‚úï</button>
        </div>

        <form method="POST" action="{% url 'cerrar_siniestro' siniestro.id %}">
            {% csrf_token %}
            <div class="p-6 space-y-6">
                <div class="text-center">
                    <div class="w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center mx-auto mb-4">
                        <span class="text-3xl">üèÅ</span>
                    </div>
                    <h3 class="text-lg font-bold text-gray-800">¬øDesea cerrar el caso #{{ siniestro.id }}?</h3>
                    <p class="text-sm text-gray-600 mt-2">
                        Al cerrar el siniestro, este quedar√° archivado como finalizado y ya no podr√° ser modificado.
                        <br>
                        <strong>Aseg√∫rese de que el usuario ya recibi√≥ el pago.</strong>
                    </p>
                </div>

                <div class="flex items-center justify-center gap-2 mt-4">
                    <input type="checkbox" required id="check_cerrar" class="w-5 h-5 text-blue-900 rounded cursor-pointer">
                    <label for="check_cerrar" class="text-sm text-gray-800 cursor-pointer font-medium">S√≠, cerrar definitivamente</label>
                </div>
            </div>

            <div class="bg-gray-50 px-6 py-4 rounded-b-lg flex justify-end gap-3 border-t">
                <button type="button" onclick="cerrarModal('modal-cerrar')" class="px-4 py-2 border rounded-lg">Cancelar</button>
                <button type="submit" class="px-6 py-2 bg-[#0B3C5D] text-white rounded-lg hover:bg-slate-800">Cerrar Caso</button>
            </div>
        </form>
    </div>
</div>


<script>
    // ========================================
    // SISTEMA DE UPLOAD DE ARCHIVOS UNIFICADO
    // ========================================
    
    // Inicializar todos los contenedores de upload al cargar la p√°gina
    document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('.upload-container').forEach(container => {
            const inputId = container.dataset.inputId;
            const name = container.dataset.name;
            const accept = container.dataset.accept;
            const title = container.dataset.title;
            const subtitle = container.dataset.subtitle;
            const color = container.dataset.color || 'blue';
            
            // Colores seg√∫n el tema
            const colors = {
                blue: {
                    border: 'border-blue-300',
                    bg: 'bg-blue-50/30',
                    hover: 'hover:bg-blue-50',
                    iconBg: 'bg-blue-100',
                    iconText: 'text-blue-600',
                    text: 'text-blue-700',
                    badge: 'border-blue-200'
                },
                green: {
                    border: 'border-green-300',
                    bg: 'bg-green-50/30',
                    hover: 'hover:bg-green-50',
                    iconBg: 'bg-green-100',
                    iconText: 'text-green-600',
                    text: 'text-green-700',
                    badge: 'border-green-200'
                },
                orange: {
                    border: 'border-orange-300',
                    bg: 'bg-orange-50/30',
                    hover: 'hover:bg-orange-50',
                    iconBg: 'bg-orange-100',
                    iconText: 'text-orange-600',
                    text: 'text-orange-700',
                    badge: 'border-orange-200'
                }
            };
            
            const theme = colors[color];
            
            // Crear el HTML del componente
            container.innerHTML = `
                <div class="border-t pt-4">
                    <label class="block text-sm font-medium text-gray-700 mb-3">${title}</label>
                    <div class="border-2 border-dashed ${theme.border} rounded-lg p-6 ${theme.bg} ${theme.hover} transition-colors">
                        <input type="file" 
                               name="${name}" 
                               id="${inputId}"
                               required 
                               accept="${accept}"
                               class="hidden"
                               onchange="handleFileSelect('${inputId}', '${color}')">
                        <label for="${inputId}" class="cursor-pointer flex flex-col items-center gap-2">
                            <div class="w-12 h-12 ${theme.iconBg} rounded-full flex items-center justify-center">
                                <svg class="w-6 h-6 ${theme.iconText}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                                </svg>
                            </div>
                            <span class="text-sm font-medium ${theme.text}">Haga clic para seleccionar archivo</span>
                            <span class="text-xs text-gray-500">${subtitle}</span>
                        </label>
                        <div id="preview-${inputId}" class="mt-3 text-sm text-gray-600 text-center hidden">
                            <span class="inline-flex items-center gap-2 bg-white px-3 py-1.5 rounded-full border ${theme.badge}">
                                <svg class="w-4 h-4 ${theme.iconText}" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z" clip-rule="evenodd"></path>
                                </svg>
                                <span id="filename-${inputId}" class="font-medium"></span>
                                <button type="button" onclick="clearFile('${inputId}')" class="ml-1 text-gray-400 hover:text-red-500">
                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                                    </svg>
                                </button>
                            </span>
                        </div>
                    </div>
                </div>
            `;
        });
    });
    
    // Manejar selecci√≥n de archivo
    function handleFileSelect(inputId, color) {
        const input = document.getElementById(inputId);
        const preview = document.getElementById('preview-' + inputId);
        const filename = document.getElementById('filename-' + inputId);
        
        if (input.files && input.files[0]) {
            filename.textContent = input.files[0].name;
            preview.classList.remove('hidden');
        }
    }
    
    // Limpiar archivo seleccionado
    function clearFile(inputId) {
        const input = document.getElementById(inputId);
        const preview = document.getElementById('preview-' + inputId);
        
        input.value = '';
        preview.classList.add('hidden');
    }
    
    // ========================================
    // FUNCIONES DE C√ÅLCULO (YA EXISTENTES)
    // ========================================
    
    function calcularDeducible() {
        const inputMonto = document.getElementById('input-monto');
        const inputDeducible = document.getElementById('input-deducible');
        
        if (!inputMonto || !inputDeducible) return;

        const monto = parseFloat(inputMonto.value) || 0;
        const porcentaje = parseFloat(document.getElementById('deducible-porcentaje').value) || 0;

        const deducibleAplicado = (monto * porcentaje) / 100;
        inputDeducible.value = deducibleAplicado.toFixed(2);

        calcularLiquidacion();
    }

    function calcularLiquidacion() {
        const inputMonto = document.getElementById('input-monto');
        const inputDeducible = document.getElementById('input-deducible');
        const displayTotal = document.getElementById('display-total');

        if (!inputMonto || !inputDeducible) return;

        const monto = parseFloat(inputMonto.value) || 0;
        const deducible = parseFloat(inputDeducible.value) || 0;
        
        const total = Math.max(0, monto - deducible);
        displayTotal.textContent = `$ ${total.toFixed(2)}`;
    }
</script>